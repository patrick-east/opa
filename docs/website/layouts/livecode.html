<section id="gray">

    <div class="gray-top-image"><img src="./img/gray-top.png"></div>
    <section id="declarative-policy">
  
    <div class="container">
          <div class="row desktopView">
              <div class="col-12 text-center pt-5">
                <h2>Declarative Policy</h2>
                <div class="subText">Context-aware, Expressive, Fast, Portable</div>
              </div>
               <div class="mr-auto  col-md-4 col-lg-3"></div>
              <div class="col-12  col-md-8  col-lg-9 mt-sm-5">
                <div class="declarative-table mt-5">
                  <div class="verticle-tabs">
                    <ul class="nav nav-tabs flex-column" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" id="tabs-5" role="tab" id="showTable">
                          Policy 1
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" id="tabs-6" role="tab">
                          Policy 2
                        </a>
                      </li>
                    </ul>
                  </div>
    
                  
    
                    <div class="tab-pane " id="tab-5" role="tabpanel">
                        <ul class="nav nav-tabs" role="tablist" id="tableOne">
                            <li class="nav-item">
                              <a class="nav-link nav-width active" data-toggle="tab" href="#tabs-1"  role="tab">
                                <img src="./img/policyIcon-1.png">
                                Kubernetes</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link nav-width" data-toggle="tab" href="#tabs-2"  role="tab">
                                <img src="./img/policyIcon-2.png" class="envoyLogo">
                                Envoy</a>
                            </li>
                            <!-- <li class="nav-item">
                              <a class="nav-link nav-width" data-toggle="tab" href="#tabs-3" role="tab">
                                <img src="./img/policyIcon-3.png">
                                Terraform</a>
                            </li> -->
                            <li class="nav-item">
                              <a class="nav-link nav-width" data-toggle="tab" href="#tabs-4" role="tab">
                                <img src="./img/policyIcon-4.png">
                                Application</a>
                            </li>
                          </ul>
    
                          <div class="tab-content">
                              <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="tab-innerContainer">
                                    <div class="col-12 highlight">
                                        <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                          <code class="language-live" data-lang="live:kubernetes_1:input:hidden">
              {
                  "apiVersion": "admission.k8s.io/v1beta1",
                  "kind": "AdmissionReview",
                  "request": {
                      "kind": {
                          "group": "",
                          "kind": "Pod",
                          "version": "v1"
                      },
                      "object": {
                          "metadata": {
                              "name": "myapp"
                          },
                          "spec": {
                              "containers": [
                                  {
                                      "image": "nginx",
                                      "name": "nginx-frontend"
                                  },
                                  {
                                      "image": "mysql",
                                      "name": "mysql-backend"
                                  }
                              ]
                          }
                      }
                  }
              }
                                          </code>
                                        </pre>
                                      </div>
                                      <div class="highlight">
                                        <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                          <code class="language-live" data-lang="live:kubernetes_1:module:openable">package kubernetes.admission
              # reject any Pod with an image not from hooli.com
              deny[msg] {
                  input.request.kind.kind == "Pod"
                  image := input.request.object.spec.containers[_].image
                  not startswith(image, "hooli.com/")
                  msg := sprintf("image '%v' comes from untrusted registry", [image])
              }
                                          </code>
                                        </pre>
                                      </div>
                                      <div class="highlight">
                                        <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                          <code class="language-live" data-lang="live:kubernetes_1:output:hidden">
                                          </code>
                                        </pre>
                                      </div>
              
                                </div>
              
                              </div>
                              <div class="tab-pane" id="tabs-2" role="tabpanel">
                                  <div class="col-12 highlight">
                                      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                        <code class="language-live" data-lang="live:envoy_1:input:hidden">
            {
                "attributes": {
                    "destination": {
                        "address": {
                            "Address": {
                                "SocketAddress": {
                                    "PortSpecifier": {
                                        "PortValue": 8000
                                    },
                                    "address": "172.17.0.8"
                                }
                            }
                        }
                    },
                    "request": {
                        "http": {
                            "headers": {
                                ":authority": "example-app",
                                ":method": "GET",
                                ":path": "/pets",
                                "user-agent": "Wget",
                                "x-forwarded-proto": "http",
                                "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                            },
                            "host": "example-app",
                            "id": "8910035251488566126",
                            "method": "GET",
                            "path": "/pets",
                            "protocol": "HTTP/1.1"
                        }
                    },
                    "source": {
                        "address": {
                            "Address": {
                                "SocketAddress": {
                                    "PortSpecifier": {
                                        "PortValue": 54292
                                    },
                                    "address": "172.17.0.6"
                                }
                            }
                        }
                    }
                },
                "parsed_path": [
                    "pets"
                ]
            }
                                        </code>
                                      </pre>
                                    </div>
                                    <div class="highlight">
                                      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                        <code class="language-live" data-lang="live:envoy_1:module:openable">package envoy.authz
            
            # allow all GET requests to /pets
            allow {
              input.attributes.request.http.method == "GET"
                input.attributes.request.http.path == "/pets"
            }
                                        </code>
                                      </pre>
                                    </div>
                                    <div class="highlight">
                                      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                        <code class="language-live" data-lang="live:envoy_1:output:hidden">
                                          <!-- example output -->
                                        </code>
                                      </pre>
                                    </div>
                                          </div>
                              <!-- <div class="tab-pane" id="tabs-3" role="tabpanel">
                                <div class="col-12 whitebox">
                                  <p>
                                      # Fine-Grained SSH Authorization<br>
                                      package ssh.fine_grained<br>
                                      # Allow users in the “dev” organization to SSH into hosts if they
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      # possess a certificate proving they are assigned to an application<br>
                                      # running on the host.<br>
                                      allow {<br>
                                      # Extract the X.509 certificate provided in the policy query.<br>
                                      certs := crypto.x509.parse_certificates(input.certificates)<br>
                                      # Check that the user is part of the “dev” organization for an app<br>
                                      # running on this host.<br>
                                      certs[ i ].Subject.Organization[ j ] == data.host_info.apps[ _ ]<br>
                                      certs[ i ].Subject.OrganizationalUnit[ j ] == “dev”<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      time.now_ns() >= certs[ i ].NotBefore<br>
                                      time.now_ns() <= certs[ i ].NotAfter<br>
                                  </p>
                                </div>
                              </div> -->
                              <div class="tab-pane" id="tabs-4" role="tabpanel">
                                  <div class="col-12 highlight">
                                      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                        <code class="language-live" data-lang="live:app_1:input:hidden">
            {
                "method": "PUT",
                "owner": "bob@hooli.com",
                "path": [
                    "pets",
                    "pet113-987"
                ],
                "user": "alice@hooli.com"
            }
                                        </code>
                                      </pre>
                                    </div>
                                    <div class="highlight">
                                      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                        <code class="language-live" data-lang="live:app_1:module:openable">package application.authz
            
            # Only owner can update the pet's information
            # Ownership information is provided as part of OPA's input
            default allow = false
            allow {
               input.method == "PUT"
               input.path = ["pets", petid]
               input.user == input.owner
            }
                                        </code>
                                      </pre>
                                    </div>
                                    <div class="highlight">
                                      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                                        <code class="language-live" data-lang="live:app_1:output:hidden">
                                          <!-- example output -->
                                        </code>
                                      </pre>
                                    </div>
                                          </div>
                            </div>
                    </div>
                    
                    <div class="tab-pane tohide" id="tab-6"  role="tabpanel">
                        <ul class="nav nav-tabs" role="tablist" id="tableOne">
                            <li class="nav-item">
                              <a class="nav-link nav-width active"  data-toggle="tab" href="#tabs-11" role="tab">
                                <img src="./img/policyIcon-1.png">
                                Kubernetes</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link nav-width" data-toggle="tab" href="#tabs-22" role="tab">
                                <img src="./img/policyIcon-2.png" class="envoyLogo">
                                Envoy</a>
                            </li>
                            <!-- <li class="nav-item">
                              <a class="nav-link nav-width" data-toggle="tab" href="#tabs-33" role="tab">
                                <img src="./img/policyIcon-3.png">
                                Terraform</a>
                            </li> -->
                            <li class="nav-item">
                              <a class="nav-link nav-width" data-toggle="tab" href="#tabs-44" role="tab">
                                <img src="./img/policyIcon-4.png">
                                Application</a>
                            </li>
                          </ul>
    
                          <div class="tab-content">
                              <div class="tab-pane active" id="tabs-11" role="tabpanel">
                                <div class="tab-innerContainer">
                                  <div class="col-12 whitebox">
                                    <p>
                                        # Example Output:<br>
                                        #<br>
                                        # Conditions (1)<br>
                                        # ———————<br>
                                    </p>
                                  </div>
                                  <div class="col-12 whitebox">
                                    <p>
                                        
                                        # data.posts [ x ].owner = “bob”<br>
                                        # Conditions (2)<br>
                                        # ———————<br>
                                        # data.posts[ x ].department = “ops”<br>
                                        # data.posts[ x ].clearance_level <= 3<br>
                                    </p>
                                  </div>
                                  <div class="col-12 whitebox">
                                    <p>Allow users to see posts from their own department<br>
                                        that they have sufficient clearance for.</p>
                                  </div>
                                </div>
              
                              </div>
                              <div class="tab-pane" id="tabs-22" role="tabpanel">
                                <div class="col-12 whitebox">
                                  <p>
                                      package kubernetes.invariants<br>
                                      import data.kubernetes.ingresses<br>
                                      import data.kubernetes.namespaces<br>
                                      # Kubernetes Admission Control Invariants<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      certs [ i ].Subject.Organization[ j ] == data.host_info.apps [ _ ]<br>
                                      certs [ i ].Subject.OrganizationalUnit [ j ] == “dev”<br>
                                      }<br>
                                      # Check the certificate’s validity period at the time of login.<br>
                                      time.now_ns() >= certs [ i ].NotBefore<br>
                                      time.now_ns() <= certs [ i ].NotAfter<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      contains (list, item) {<br>
                                        list [ _ ] = item<br>
                                  </p>
                                </div>
                              </div>
                              <!-- <div class="tab-pane" id="tabs-33" role="tabpanel">
                                <div class="col-12 whitebox">
                                  <p>
                                      # Kubernetes Admission Control Invariants<br>
                                      package kubernetes.invariants<br>
                                      import data.kubernetes.ingresses<br>
                                      import data.kubernetes.namespaces<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      - filters:<br>
                                      - name: envoy.http_connection_manager<br>
                                      typed_config:<br>
                                      “@type”: type.googleapis.com/<br>
                                      envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager<br>
                                      codec_type: auto<br>
                                      stat_prefix: ingress_http<br>
                                      route_config:<br>
                                      name: local_route<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      stat_prefix: ext_authz<br>
                                      timeout: 0.5s<br>
                                      - name: envoy.router<br>
                                  </p>
                                </div>
                              </div> -->
                              <div class="tab-pane" id="tabs-44" role="tabpanel">
                                <div class="col-12 whitebox">
                                  <p>
                                      token = { “valid”: valid, “payload”: payload } { <br>
                                        [ _, encoded ] := split ( http_request.headers.authorization, “ “ )<br>
                                        [valid, _ , payload] := io.jwt.decode_verify ( encoded, { “secret”:<br>
                                        “secret” })<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      allow { <br>
                                        is_token_valid<br>
                                        action_allowed<br>
                                        }<br>
                                        is_token_valid {<br>
                                        token.valid<br>
                                        token.payload.nbf <= time.now_ns() < token.payload.exp<br>
                                  </p>
                                </div>
                                <div class="col-12 whitebox">
                                  <p>
                                      token.payload.role == “guest”<br>
                                      glob.match ( “/people*”, [], http_request.path )<br>
                                  </p>
                                </div>
                              </div>
                            </div>
                    </div>
                </div>
              </div> 

    
            </div>





        <div class="row mobileView">
            <div class="col-12 text-center pt-5">
              <h2>Declarative Policy</h2>
              <div class="subText">Context-aware, Expressive, Fast, Portable</div>
            </div>
            <div class="col-12 mt-3 mt-sm-5">
              <div class="row">
                <div class="col-6 col-sm-6 col-md-6 col-lg-3">
                  <div class="declarativeBOx">
                    <a href="#kubernetes">
                      <div class="declarativeInnerBOx">
                        <img src="./img/policyIcon-1.png" class="declarativeImage">
                        <p class="declarativeText">Kubernetes</p>
                      </div>
  
                      <div class="downArrow">
                        <img src="./img/downArrow.svg">
                      </div>
                    </a>
  
                  </div>
                </div>
  
                <div class="col-6 col-sm-6 col-md-6 col-lg-3">
                  <div class="declarativeBOx envoy">
                    <a href="#envoy">
                      <div class="declarativeInnerBOx ">
                        <img src="./img/policyIcon-2.png" class="declarativeImage">
                        <p class="declarativeText">Envoy</p>
                      </div>
  
                      <div class="downArrow">
                        <img src="./img/downArrow.svg">
                      </div>
                    </a>
  
                  </div>
                </div>
  
                <div class="col-6 col-sm-6 col-md-6 col-lg-3">
                  <div class="declarativeBOx">
                    <a href="#application">
                      <div class="declarativeInnerBOx">
                        <img src="./img/policyIcon-4.png" class="declarativeImage">
                        <p class="declarativeText">Application</p>
                      </div>
  
                      <div class="downArrow">
                        <img src="./img/downArrow.svg">
                      </div>
                    </a>
  
                  </div>
                </div>
              </div>
            </div>
  
            <div class="col-12 mt-3 mt-sm-5" id="kubernetes">
              <div class="declarative-policy-contentBox">
                <div class="declarative-policy-contentBox-header">
                  <img src="./img/policyIcon-1.png" class="declarativeImage">
                  <p class="declarativeText">Kubernetes</p>
                </div>
                <div class="row">
                  <div class="col-12 col-sm-12 col-md-12 col-lg-4">
                    <div class="declarative-left">
                        <div class="current"></div>
                      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home"
                          role="tab" aria-controls="v-pills-home" aria-selected="true">Ensure all images come from a trusted registry</a>
                        <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab"
                          aria-controls="v-pills-profile" aria-selected="false">Stop ingresses from using the same host name</a>
  
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-sm-12 col-md-12 col-lg-8 ">
                    <div class="declarative-right">
                      <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                          aria-labelledby="v-pills-home-tab">
                          <div class="col-12 highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:kubernetes_1:input:hidden">
  {
      "apiVersion": "admission.k8s.io/v1beta1",
      "kind": "AdmissionReview",
      "request": {
          "kind": {
              "group": "",
              "kind": "Pod",
              "version": "v1"
          },
          "object": {
              "metadata": {
                  "name": "myapp"
              },
              "spec": {
                  "containers": [
                      {
                          "image": "nginx",
                          "name": "nginx-frontend"
                      },
                      {
                          "image": "mysql",
                          "name": "mysql-backend"
                      }
                  ]
              }
          }
      }
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:kubernetes_1:module:openable">package kubernetes.admission
  
  deny[msg] {
      input.request.kind.kind == "Pod"
      image := input.request.object.spec.containers[_].image
      not startswith(image, "hooli.com/")
      msg := sprintf("image '%v' comes from untrusted registry", [image])
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:kubernetes_1:output:hidden">
                              </code>
                            </pre>
                          </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-profile" role="tabpanel"
                          aria-labelledby="v-pills-profile-tab">
                          <div class="col-12 highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:kubernetes_2:input:hidden">
  {
      "apiVersion": "admission.k8s.io/v1beta1",
      "kind": "AdmissionReview",
      "request": {
          "kind": {
              "group": "extensions",
              "kind": "Ingress",
              "version": "v1beta1"
          },
          "object": {
              "metadata": {
                  "name": "prod",
                  "namespace": "bar"
              },
              "spec": {
                  "rules": [
                      {
                          "host": "initech.com",
                          "http": {
                              "paths": [
                                  {
                                      "backend": {
                                          "serviceName": "banking",
                                          "servicePort": 443
                                      },
                                      "path": "/finance"
                                  }
                              ]
                          }
                      }
                  ]
              }
          }
      }
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:kubernetes_2:module:openable">package kubernetes.admission
  
  deny[msg] {
    some namespace, name
    input.request.kind.kind == "Ingress"
    newhost := input.request.object.spec.rules[_].host
    oldhost := ingresses[namespace][name].spec.rules[_].host
    newhost == oldhost
    input.request.object.metadata.namespace != namespace
    input.request.object.metadata.name != name
    msg := sprintf("ingress host conflicts with ingress %v/%v", [namespace, name])
  }
  
  
  # Hardcoded for demo.  In reality injected into OPA through API
  ingresses = {
    "foo": {
      "dev": {
        "apiVersion": "extensions/v1beta1",
        "kind": "Ingress",
        "metadata": {
          "name": "dev",
          "namespace": "foo"
        },
        "spec": {
          "rules": [{
            "host": "initech.com",
            "http": {
              "paths": [{
                "path": "/finance",
                "backend": {
                  "serviceName": "banking",
                  "servicePort": 443
  }}]}}]}}}}
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:kubernetes_2:output:hidden">
                                <!-- example output -->
                              </code>
                            </pre>
                          </div>
                        </div>
  
  
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
            <div class="col-12 mt-3 mt-sm-5" id="envoy">
              <div class="declarative-policy-contentBox">
                <div class="declarative-policy-contentBox-header">
                  <img src="./img/policyIcon-2.png" class="declarativeImage">
                  <p class="declarativeText declarativeEnvoy">Envoy</p>
                </div>
                <div class="row">
                  <div class="col-12 col-sm-12 col-md-12 col-lg-4">
                    <div class="declarative-left">
  
                      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-one"
                           role="tab" aria-controls="v-pills-home" aria-selected="true">Allow everyone to run GET on <code>/pets</code></a>
                        <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-two" role="tab"
                           aria-controls="v-pills-profile" aria-selected="false">Allow frontend service to run GET on <code>/pets/owners</code></a>
  
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-sm-12 col-md-12 col-lg-8">
                    <div class="declarative-right">
                      <div class="tab-content" id="v-pills-tabContent">
  
                        <div class="tab-pane fade show active" id="v-pills-one" role="tabpanel"
                          aria-labelledby="v-pills-home-tab">
                          <div class="col-12 highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:envoy_1:input:hidden">
  {
      "attributes": {
          "destination": {
              "address": {
                  "Address": {
                      "SocketAddress": {
                          "PortSpecifier": {
                              "PortValue": 8000
                          },
                          "address": "172.17.0.8"
                      }
                  }
              }
          },
          "request": {
              "http": {
                  "headers": {
                      ":authority": "example-app",
                      ":method": "GET",
                      ":path": "/pets",
                      "user-agent": "Wget",
                      "x-forwarded-proto": "http",
                      "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                  },
                  "host": "example-app",
                  "id": "8910035251488566126",
                  "method": "GET",
                  "path": "/pets",
                  "protocol": "HTTP/1.1"
              }
          },
          "source": {
              "address": {
                  "Address": {
                      "SocketAddress": {
                          "PortSpecifier": {
                              "PortValue": 54292
                          },
                          "address": "172.17.0.6"
                      }
                  }
              }
          }
      },
      "parsed_path": [
          "pets"
      ]
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:envoy_1:module:openable">package envoy.authz
  
        # allow all GET requests to /pets
        allow {
          input.attributes.request.http.method == "GET"
            input.attributes.request.http.path == "/pets"
        }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:envoy_1:output:hidden">
                                <!-- example output -->
                              </code>
                            </pre>
                          </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-two" role="tabpanel"
                          aria-labelledby="v-pills-profile-tab">
                          <div class="col-12 highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:envoy_2:input:hidden">
  {
      "attributes": {
          "destination": {
              "address": {
                  "Address": {
                      "SocketAddress": {
                          "PortSpecifier": {
                              "PortValue": 8000
                          },
                          "address": "172.17.0.8"
                      }
                  }
              }
          },
          "request": {
              "http": {
                  "headers": {
                      ":authority": "example-app",
                      ":method": "GET",
                      ":path": "/pets/owners",
                      "user-agent": "Wget",
                      "x-forwarded-client-cert": "By=spiffe://domain.test/db-server;Hash=331f2f4eb2a1729fa4e0f46c8c663786098151ae571fed7b66680e970f6a0f94;URI=spiffe://domain.test/frontend",
                      "x-forwarded-proto": "http",
                      "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                  },
                  "host": "example-app",
                  "id": "8910035251488566126",
                  "method": "GET",
                  "path": "/pets/owners",
                  "protocol": "HTTP/1.1"
              }
          },
          "source": {
              "address": {
                  "Address": {
                      "SocketAddress": {
                          "PortSpecifier": {
                              "PortValue": 54292
                          },
                          "address": "172.17.0.6"
                      }
                  }
              }
          }
      },
      "parsed_path": [
          "pets",
          "owners"
      ]
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:envoy_2:module:openable">package envoy.authz
  import input.attributes.request.http as http_request
  
  default allow = false
  allow {
      http_request.path == "/pets/owners"
      http_request.method == "GET"
      source_spiffe_id == "spiffe://domain.test/frontend"
  }
  
  source_spiffe_id = client_id {
      [_, _, uri_type_san] := split(http_request.headers["x-forwarded-client-cert"], ";")
      [_, client_id] := split(uri_type_san, "=")
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:envoy_2:output:hidden">
                                <!-- example output -->
                              </code>
                            </pre>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
            <div class="col-12 mt-3 mt-sm-5" id="application">
              <div class="declarative-policy-contentBox">
                <div class="declarative-policy-contentBox-header">
                  <img src="./img/policyIcon-4.png" class="declarativeImage">
                  <p class="declarativeText">Application</p>
                </div>
                <div class="row">
                  <div class="col-12  col-sm-12 col-md-12 col-lg-4">
                    <div class="declarative-left">
                      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-five"
                          role="tab" aria-controls="v-pills-home" aria-selected="true">Only the pet's owner can update that pet's information</a>
                        <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-six" role="tab"
                          aria-controls="v-pills-profile" aria-selected="false">Only employees, authenticated with a JWT, can see already adopted pets</a>
  
                      </div>
                    </div>
                  </div>
                  <div class="col-12  col-sm-12 col-md-12 col-lg-8">
                    <div class="declarative-right">
                      <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-five" role="tabpanel"
                          aria-labelledby="v-pills-home-tab">
                          <div class="col-12 highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:app_1:input:hidden">
  {
      "method": "PUT",
      "owner": "bob@hooli.com",
      "path": [
          "pets",
          "pet113-987"
      ],
      "user": "alice@hooli.com"
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:app_1:module:openable">package application.authz
  
  # Only owner can update the pet's information
  # Ownership information is provided as part of OPA's input
  default allow = false
  allow {
     input.method == "PUT"
     input.path = ["pets", petid]
     input.user == input.owner
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:app_1:output:hidden">
                                <!-- example output -->
                              </code>
                            </pre>
                          </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-six" role="tabpanel"
                          aria-labelledby="v-pills-profile-tab">
                          <div class="col-12 highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:app_2:input:hidden">
  {
      "pet_list": [
          {
              "breed": "St. Bernard",
              "name": "Cujo",
              "up_for_adoption": false
          },
          {
              "breed": "Collie",
              "name": "Lassie",
              "up_for_adoption": true
          }
      ],
      "token": "eyJ1IjoiSFMyNTYiLCJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWxpY2UiLCJlbXBsb3llZSI6dHJ1ZSwibmFtZSI6IkFsaWNlIFNtaXRoIn0.vMBYEW8VK9XM7yPkKTu1C3Gy1tOq1A0d4-xYMkkRpEc"
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:app_2:module:openable">
  package application.authz
  
  # Everyone can see adopted pets
  allowed_pets[pet] {
    pet := input.pet_list[_]
      pet.up_for_adoption == true
  }
  
  # Employees can see all pets.
  #   Hint: to see token contents, highlight and evaluate the line with io.jwt.decode.
  #   To build your own JWT token you can use OPA's io.jwt.encode_sign()
  #      https://www.openpolicyagent.org/docs/latest/policy-reference/#token-signing-examples
  allowed_pets[pet] {
    pet := input.pet_list[_]
      [header, payload, signature] := io.jwt.decode(input.token)
      payload.employee == true
  }
                              </code>
                            </pre>
                          </div>
                          <div class="highlight">
                            <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
                              <code class="language-live" data-lang="live:app_2:output:hidden">
                                <!-- example output -->
                              </code>
                            </pre>
                          </div>
                        </div>
  
  
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
          </div>
      </div>
    </section>
    <div class="declarative-policy-tabs-graphic-2"></div>
  </section>

  <section id="declarative-policy-tabs">
    <div class="declarative-policy-tabs-graphic"></div>

    <div class="container">
      <div class="row">
        <div class="col-12 col-sm-12 col-md-6">
          <p><span style="font-weight:600">Declarative.</span> Express policy in a high-level,
            declarative language that promotes safe,
            performant, fine-grained controls. Use a language
            purpose-built for policy in a world where JSON is
            pervasive. Iterate, traverse hierarchies, and apply
            50+ built-ins like string manipulation and JWT
            decoding to declare the policies you want enforced.</p>
        </div>
        <div class="col-12 col-sm-12 col-md-6 mt-3 mt-sm-0">
          <p><span style="font-weight:600">Context-aware.</span> Leverage external information to
            write the policies you really care about. Stop
            inventing roles that represent complex relationships
            that years down the road no one will understand.
            Instead, write logic that adapts to the world around
            it and attach that logic to the systems that need it.</p>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="mt-5 text-center blue">
            <button class="btn btn-primary"><a><span>Learn More:</span> <a href="./docs/latest/kubernetes-introduction/">Kubernetes</a> - <a
              href="./docs/latest/envoy-authorization/">Envoy</a> - <a href="./docs/latest/terraform/">Terraform</a> - <a href="./docs/latest/kafka-authorization/">Kafka</a>
            - <a href="https://blog.openpolicyagent.org/write-policy-in-opa-enforce-policy-in-sql-d9d24db93bf4">SQL</a> - <a href="./docs/latest/ssh-and-sudo-authorization/">Linux</a></button>
          </div>
        </div>
      </div>
    </div>
  </section>
